# MATLAB function `get_footstep_cluster_indices`

Click [here](get_footstep_cluster_indices.m) to see the source code.

To extract the gait parameters without the aid of heel-strike and toe-off timing information provided by the insole sensor, it is necessary to preprocess the raw ankle tracking data generated by the Kinect SDK, i.e. to group data points into footstep clusters. Before, we had an unsuccessful attempt to use the ankle speed signal (calculated by differentiating the position signal and smoothing it using a moving average filter) to do footstep clustering, mainly because of the high noise in the Kinect data. It turns out that relying directly on the position signal is a better solution.

This function takes three n-by-1 vectors, `x`, `y`, and `t` as inputs, representing the sequence of timestamped Kinect measurement of either ankle joint positions. Two m-by-1 vectors `i_start` and `i_end` returned from the function contain the start and end indices of the footstep clusters. Below are the steps for finding the footstep clusters:

1. A sequence of footstep cluster candidates indexed [`i_start_cand`, `i_end_cand`] is initialized to include 5 data points.
2. For each cluster candidate, we keep incrementing the index of right endpoint of this interval until:
    1. the number of outliers `num_outliers` in this interval exceeds 3 (A point in an interval is said to be an outlier if its distance to the left endpoint exceeds `dist_threshold`);
    2. the number of points in the interval reaches 30; or
    3. the right endpoint of this interval reaches the last point in the input sequence.
3. After looping through all the cluster candidates, we use `findpeaks` function on the vector `sep_cand` of the number points in the footstep cluster candidates, such that `MinPeakHeight = min_num_points` and `MinPeakDistance = min_peak_sep`.
